{"version":3,"sources":["db.js","app.js","index.js"],"names":["Pool","require","pool","user","host","database","password","port","module","exports","express","cors","html","app","use","origin","json","urlencoded","extended","get","req","res","set","status","send","result","query","rows","err","error","message","post","email","username","body","console","log","put","id","params","fname","lname","search","min_price","max_price","state","category","start_date","end_date","listen"],"mappings":"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","file":"index.js","sourceRoot":"../src","sourcesContent":["const { Pool } = require(\"pg\");\n\nconst pool = new Pool({\n  user: \"admin\",\n  host: \"localhost\",\n  database: \"capyborrow-db\",\n  password: \"admin\",\n  port: 5432,\n});\n\nmodule.exports = pool;\n","const express = require('express');\r\nconst cors = require('cors');\r\nconst pool = require('./db');\r\n\r\nconst html = `<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <title>A JavaScript project</title>\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n</head>\r\n<body>\r\n  <h1>A JavaScript project</h1>\r\n</body>\r\n</html>`;\r\n\r\nconst app = express();\r\n\r\napp.use(cors({origin: \"http://localhost:3000\"}));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: true }));\r\n\r\n\r\napp.get('/', (req, res) => {\r\n  res.set('Content-Type', 'text/html');\r\n  res.status(200).send(html);\r\n});\r\n\r\n/*USER*/\r\napp.get('/users', async (req, res) => {\r\n  try {\r\n    const result = await pool.query(\"SELECT * FROM capyborrow.user\");\r\n    res.json(result.rows);\r\n  } catch (err) {\r\n    res.status(500).json({error : err.message});\r\n  }\r\n});\r\n\r\napp.post('/users', async (req, res) => {\r\n  const {email, username} = req.body;\r\n  try {\r\n    const result = await pool.query(\r\n      `INSERT INTO Capyborrow.user(email, username)\r\n        VALUES($1, $2)`,\r\n        [email, username]\r\n    );\r\n    if (!rows[0]) {\r\n      return res.status(500).json({ error: \"Utilisateur non créé\" });\r\n    }\r\n    res.status(201).json(result.rows[0]);\r\n  }\r\n  catch (err) {\r\n    console.log(\"la\");\r\n    res.status(500).json({error : err.message});\r\n  }\r\n});\r\n\r\napp.put('/users/:id', async (req, res) => {\r\n  const {id} = req.params;\r\n  const {username, fname, lname} = req.body;\r\n  try {\r\n    const result = await pool.query(\r\n      `UPDATE Capyborrow.user\r\n        SET username = $1,\r\n            firstname = $2,\r\n            lastname = $3\r\n        WHERE user_id = $4\r\n        RETURNING *;`,\r\n        [username, fname, lname, id]\r\n    );\r\n    if (!result.rows[0]) {\r\n      return res.status(404).json({ error: \"Utilisateur introuvable\" });\r\n    }\r\n    res.status(200).json(result.rows[0]);\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message});\r\n  }\r\n});\r\n\r\n\r\n/*ITEM*/\r\n\r\napp.get('/item', async (req,res) => {\r\n  const {search, min_price, max_price, state, category, start_date, end_date} = req.query;\r\n  try {\r\n    const result = await pool.query(`\r\n      SELECT *\r\n      FROM Capyborrow.all_items_display AS i\r\n      WHERE ($1::text IS NULL OR i.name ILIKE '%' || $1 || '%')\r\n        AND ($2::int  IS NULL OR i.price >= $2)\r\n        AND ($3::int  IS NULL OR i.price <= $3)\r\n        AND ($4::text IS NULL OR i.state = $4)\r\n        AND ($5::text IS NULL OR i.category1 = $5)\r\n        AND ($6::date IS NULL OR $7::date IS NULL OR NOT EXISTS (\r\n               SELECT 1 FROM Capyborrow.borrow b\r\n               WHERE b.item_id = i.item_id\r\n                 AND b.start_date <= $7::date\r\n                 AND b.end_date   >= $6::date\r\n        ))`, \r\n        [search || null, min_price || null, max_price || null, state || null, category || null, start_date || null, end_date || null]);\r\n    res.json(result.rows);\r\n  } catch (err) {\r\n    res.status(500).json({error: err.message});\r\n  }\r\n});\r\n\r\n\r\n/*\r\napp.get('/item', async (req,res) => {\r\n  try {\r\n    const result = await pool.query(`SELECT * FROM capyborrow.all_items_display`);\r\n    res.json(result.rows);\r\n  } catch (err) {\r\n    res.status(500).json({error: err.message});\r\n  }\r\n});\r\n*/\r\n\r\n//post pour créer un item\r\n\r\nmodule.exports = app;","const app = require('./app');\r\n\r\nconst port = '8888';\r\n\r\napp.listen(port, () => {\r\n  console.log(`Server is listening on port ${port}...`);\r\n});"]}