{"version":3,"sources":["db.js","app.js","index.js"],"names":["Pool","require","pool","user","host","database","password","port","module","exports","express","cors","html","app","use","origin","json","urlencoded","extended","get","req","res","set","status","send","search","min_price","max_price","state","category","start_date","end_date","query","result","rows","err","error","message","listen","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM;EAAEA;AAAK,CAAC,GAAGC,OAAO,CAAC,IAAI,CAAC;AAE9B,MAAMC,IAAI,GAAG,IAAIF,IAAI,CAAC;EACpBG,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,WAAW;EACjBC,QAAQ,EAAE,eAAe;EACzBC,QAAQ,EAAE,OAAO;EACjBC,IAAI,EAAE;AACR,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAGP,IAAI;;ACVrB,MAAMQ,OAAO,GAAGT,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMU,IAAI,GAAGV,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAE5B,MAAMW,IAAI,GAAG;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AAER,MAAMC,GAAG,GAAGH,OAAO,CAAC,CAAC;AAErBG,GAAG,CAACC,GAAG,CAACH,IAAI,CAAC;EAACI,MAAM,EAAE;AAAuB,CAAC,CAAC,CAAC;AAChDF,GAAG,CAACC,GAAG,CAACJ,OAAO,CAACM,IAAI,CAAC,CAAC,CAAC;AACvBH,GAAG,CAACC,GAAG,CAACJ,OAAO,CAACO,UAAU,CAAC;EAAEC,QAAQ,EAAE;AAAK,CAAC,CAAC,CAAC;AAG/CL,GAAG,CAACM,GAAG,CAAC,GAAG,EAAE,CAACC,GAAG,EAAEC,GAAG,KAAK;EACzBA,GAAG,CAACC,GAAG,CAAC,cAAc,EAAE,WAAW,CAAC;EACpCD,GAAG,CAACE,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAACZ,IAAI,CAAC;AAC5B,CAAC,CAAC;;AAEF;;AAGA;;AAEAC,GAAG,CAACM,GAAG,CAAC,OAAO,EAAE,OAAOC,GAAG,EAACC,GAAG,KAAK;EAClC,MAAM;IAACI,MAAM;IAAEC,SAAS;IAAEC,SAAS;IAAEC,KAAK;IAAEC,QAAQ;IAAEC,UAAU;IAAEC;EAAQ,CAAC,GAAGX,GAAG,CAACY,KAAK;EACvF,IAAI;IACF,MAAMC,MAAM,GAAG,MAAM/B,IAAI,CAAC8B,KAAK,CAAC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EACH,CAACP,MAAM,IAAI,IAAI,EAAEC,SAAS,IAAI,IAAI,EAAEC,SAAS,IAAI,IAAI,EAAEC,KAAK,IAAI,IAAI,EAAEC,QAAQ,IAAI,IAAI,EAAEC,UAAU,IAAI,IAAI,EAAEC,QAAQ,IAAI,IAAI,CAAC,CAAC;IAClIV,GAAG,CAACL,IAAI,CAACiB,MAAM,CAACC,IAAI,CAAC;EACvB,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZd,GAAG,CAACE,MAAM,CAAC,GAAG,CAAC,CAACP,IAAI,CAAC;MAACoB,KAAK,EAAED,GAAG,CAACE;IAAO,CAAC,CAAC;EAC5C;AACF,CAAC,CAAC;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA7B,MAAM,CAACC,OAAO,GAAGI,GAAG;;ACtEpB,MAAMA,GAAG,GAAGZ,OAAO,CAAC,OAAO,CAAC;AAE5B,MAAMM,IAAI,GAAG,MAAM;AAEnBM,GAAG,CAACyB,MAAM,CAAC/B,IAAI,EAAE,MAAM;EACrBgC,OAAO,CAACC,GAAG,CAAC,+BAA+BjC,IAAI,KAAK,CAAC;AACvD,CAAC,CAAC","file":"index.js","sourceRoot":"../src","sourcesContent":["const { Pool } = require(\"pg\");\n\nconst pool = new Pool({\n  user: \"admin\",\n  host: \"localhost\",\n  database: \"capyborrow-db\",\n  password: \"admin\",\n  port: 5432,\n});\n\nmodule.exports = pool;\n","const express = require('express');\r\nconst cors = require('cors');\r\nconst pool = require('./db');\r\n\r\nconst html = `<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <title>A JavaScript project</title>\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n</head>\r\n<body>\r\n  <h1>A JavaScript project</h1>\r\n</body>\r\n</html>`;\r\n\r\nconst app = express();\r\n\r\napp.use(cors({origin: \"http://localhost:3000\"}));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: true }));\r\n\r\n\r\napp.get('/', (req, res) => {\r\n  res.set('Content-Type', 'text/html');\r\n  res.status(200).send(html);\r\n});\r\n\r\n/*USER*/\r\n\r\n\r\n/*ITEM*/\r\n\r\napp.get('/item', async (req,res) => {\r\n  const {search, min_price, max_price, state, category, start_date, end_date} = req.query;\r\n  try {\r\n    const result = await pool.query(`\r\n      SELECT *\r\n      FROM Capyborrow.all_items_display AS i\r\n      WHERE ($1::text IS NULL OR i.name ILIKE '%' || $1 || '%')\r\n        AND ($2::int  IS NULL OR i.price >= $2)\r\n        AND ($3::int  IS NULL OR i.price <= $3)\r\n        AND ($4::text IS NULL OR i.state = $4)\r\n        AND ($5::text IS NULL OR i.category1 = $5)\r\n        AND ($6::date IS NULL OR $7::date IS NULL OR NOT EXISTS (\r\n               SELECT 1 FROM Capyborrow.borrow b\r\n               WHERE b.item_id = i.item_id\r\n                 AND b.start_date <= $7::date\r\n                 AND b.end_date   >= $6::date\r\n        ))`, \r\n        [search || null, min_price || null, max_price || null, state || null, category || null, start_date || null, end_date || null]);\r\n    res.json(result.rows);\r\n  } catch (err) {\r\n    res.status(500).json({error: err.message});\r\n  }\r\n});\r\n\r\n\r\n/*\r\napp.get('/item', async (req,res) => {\r\n  try {\r\n    const result = await pool.query(`SELECT * FROM capyborrow.all_items_display`);\r\n    res.json(result.rows);\r\n  } catch (err) {\r\n    res.status(500).json({error: err.message});\r\n  }\r\n});\r\n*/\r\n\r\n//post pour crÃ©er un item\r\n\r\nmodule.exports = app;","const app = require('./app');\r\n\r\nconst port = '8888';\r\n\r\napp.listen(port, () => {\r\n  console.log(`Server is listening on port ${port}...`);\r\n});"]}